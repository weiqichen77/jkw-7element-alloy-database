<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDFå’Œåº”åŠ›åº”å˜æ›²çº¿æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #667eea; }
        h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .chart-canvas {
            width: 100%;
            max-width: 800px;
            height: 300px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .data-preview {
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª RDFå’Œåº”åŠ›åº”å˜æ›²çº¿åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•1ï¼šå¾„å‘åˆ†å¸ƒå‡½æ•° (RDF)</h2>
        <div id="rdf-status" class="status info">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        <canvas id="rdf-chart" class="chart-canvas"></canvas>
        <div class="data-preview" id="rdf-data"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ˆ æµ‹è¯•2ï¼šåº”åŠ›åº”å˜æ›²çº¿ (Stress-Strain)</h2>
        <div id="stress-status" class="status info">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        <canvas id="stress-chart" class="chart-canvas"></canvas>
        <div class="data-preview" id="stress-data"></div>
    </div>
    
    <div class="test-section">
        <h2>â„¹ï¸ æµ‹è¯•è¯´æ˜</h2>
        <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
        <ul>
            <li><strong>RDFå›¾è¡¨ï¼š</strong>åº”æ˜¾ç¤ºä»1åˆ°10åŸƒçš„å¾„å‘åˆ†å¸ƒå‡½æ•°ï¼Œå…·æœ‰æ˜æ˜¾çš„å³°å€¼ç»“æ„</li>
            <li><strong>åº”åŠ›åº”å˜å›¾è¡¨ï¼š</strong>åº”æ˜¾ç¤ºä»0åˆ°10%åº”å˜çš„åº”åŠ›å“åº”æ›²çº¿</li>
        </ul>
        <p><strong>æ•°æ®æ¥æºï¼š</strong>backend/data/materials.json</p>
        <p><strong>æµ‹è¯•ææ–™ï¼š</strong>W2Zr2Fe1-amorphous (ID: 6, æ¸©åº¦: 0K, æ¥æº: DPA-1)</p>
    </div>

    <script>
        // ç®€åŒ–çš„renderPlotå‡½æ•°ï¼ˆæ¨¡æ‹Ÿå‰ç«¯ä»£ç ï¼‰
        function renderPlot(canvasId, data, title) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 300;
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(title, width / 2, 25);
            
            // è®¡ç®—æ•°æ®èŒƒå›´
            const padding = 60;
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;
            
            const xData = data.map(d => d[0]);
            const yData = data.map(d => d[1]);
            const xMin = Math.min(...xData);
            const xMax = Math.max(...xData);
            const yMin = Math.min(...yData);
            const yMax = Math.max(...yData);
            const yRange = yMax - yMin || 1;
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // ç»˜åˆ¶æ›²çº¿
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data.forEach((point, i) => {
                const x = padding + ((point[0] - xMin) / (xMax - xMin)) * plotWidth;
                const y = height - padding - ((point[1] - yMin) / yRange) * plotHeight;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // æ·»åŠ åæ ‡è½´æ ‡ç­¾
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            
            // Yè½´æ ‡ç­¾
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText(title === 'RDF' ? 'g(r)' : 'Stress (GPa)', 0, 0);
            ctx.restore();
            
            // Xè½´æ ‡ç­¾
            ctx.textAlign = 'center';
            ctx.fillText(title === 'RDF' ? 'Distance (Ã…)' : 'Strain (%)', width / 2, height - 10);
            
            // æ•°å€¼æ ‡ç­¾
            ctx.textAlign = 'right';
            ctx.fillText(yMin.toFixed(1), padding - 5, height - padding);
            ctx.fillText(yMax.toFixed(1), padding - 5, padding);
            
            ctx.textAlign = 'center';
            ctx.fillText(xMin.toFixed(1), padding, height - padding + 15);
            ctx.fillText(xMax.toFixed(1), width - padding, height - padding + 15);
            
            return true;
        }
        
        // åŠ è½½å¹¶æµ‹è¯•æ•°æ®
        fetch('./data/materials.json')
            .then(response => response.json())
            .then(materials => {
                // æŸ¥æ‰¾W2Zr2Fe1-amorphousææ–™
                const material = materials.find(m => m.name === 'W2Zr2Fe1-amorphous');
                
                if (!material) {
                    throw new Error('æœªæ‰¾åˆ°æµ‹è¯•ææ–™');
                }
                
                const dataPoint = material.data[0];
                const struct = dataPoint.properties.structure;
                const mech = dataPoint.properties.mechanics;
                
                // æµ‹è¯•RDF
                const rdfStatus = document.getElementById('rdf-status');
                const rdfDataDiv = document.getElementById('rdf-data');
                
                if (struct.rdf && Array.isArray(struct.rdf)) {
                    rdfStatus.className = 'status success';
                    rdfStatus.textContent = 'âœ… RDFæ•°æ®åŠ è½½æˆåŠŸï¼æ•°æ®ç‚¹æ•°é‡: ' + struct.rdf.length;
                    
                    rdfDataDiv.textContent = 'RDFæ•°æ®é¢„è§ˆï¼ˆå‰5ä¸ªç‚¹ï¼‰:\n' + 
                        JSON.stringify(struct.rdf.slice(0, 5), null, 2);
                    
                    renderPlot('rdf-chart', struct.rdf, 'RDF');
                } else {
                    rdfStatus.className = 'status error';
                    rdfStatus.textContent = 'âŒ RDFæ•°æ®æ ¼å¼é”™è¯¯: ' + typeof struct.rdf;
                    rdfDataDiv.textContent = 'RDFæ•°æ®: ' + JSON.stringify(struct.rdf);
                }
                
                // æµ‹è¯•åº”åŠ›åº”å˜
                const stressStatus = document.getElementById('stress-status');
                const stressDataDiv = document.getElementById('stress-data');
                
                if (mech.stressStrain && Array.isArray(mech.stressStrain)) {
                    stressStatus.className = 'status success';
                    stressStatus.textContent = 'âœ… åº”åŠ›åº”å˜æ•°æ®åŠ è½½æˆåŠŸï¼æ•°æ®ç‚¹æ•°é‡: ' + mech.stressStrain.length;
                    
                    stressDataDiv.textContent = 'åº”åŠ›åº”å˜æ•°æ®é¢„è§ˆï¼ˆå‰5ä¸ªç‚¹ï¼‰:\n' + 
                        JSON.stringify(mech.stressStrain.slice(0, 5), null, 2);
                    
                    renderPlot('stress-chart', mech.stressStrain, 'Stress-Strain');
                } else {
                    stressStatus.className = 'status error';
                    stressStatus.textContent = 'âŒ åº”åŠ›åº”å˜æ•°æ®æ ¼å¼é”™è¯¯: ' + typeof mech.stressStrain;
                    stressDataDiv.textContent = 'åº”åŠ›åº”å˜æ•°æ®: ' + JSON.stringify(mech.stressStrain);
                }
            })
            .catch(error => {
                document.getElementById('rdf-status').className = 'status error';
                document.getElementById('rdf-status').textContent = 'âŒ é”™è¯¯: ' + error.message;
                
                document.getElementById('stress-status').className = 'status error';
                document.getElementById('stress-status').textContent = 'âŒ é”™è¯¯: ' + error.message;
            });
    </script>
</body>
</html>
