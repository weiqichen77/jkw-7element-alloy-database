<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•æ•°æ®ä¼˜å…ˆçº§é€»è¾‘</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-case {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-case h3 {
            margin-top: 0;
            color: #333;
        }
        .data-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-left: 4px solid #888;
        }
        .data-item.primary {
            border-left-color: #4CAF50;
            background: #e8f5e9;
            font-weight: bold;
        }
        .data-item.secondary {
            border-left-color: #2196F3;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>æ•°æ®ä¼˜å…ˆçº§å’Œæ’åºé€»è¾‘æµ‹è¯•</h1>
    <p>æµ‹è¯•ä» <strong>https://wqchen007.github.io/jkw-7element-alloy-database/</strong> è·å–çš„å®é™…æ•°æ®</p>
    
    <div id="test-results"></div>
    
    <script>
        // å¤åˆ¶éƒ¨ç½²ç‰ˆæœ¬çš„å‡½æ•°
        function getPrimaryData(material) {
            if (!material.data || material.data.length === 0) return null;
            // Priority: 0K DFT > 0K DPA-3 > 0K DPA-1 > other 0K > first entry
            let primary = material.data.find(d => d.temperature === 0 && d.source === 'DFT');
            if (!primary) {
                primary = material.data.find(d => d.temperature === 0 && d.source === 'DPA-3');
            }
            if (!primary) {
                primary = material.data.find(d => d.temperature === 0 && d.source === 'DPA-1');
            }
            if (!primary) {
                primary = material.data.find(d => d.temperature === 0);
            }
            if (!primary) {
                primary = material.data[0];
            }
            return primary;
        }
        
        function getSecondaryData(material) {
            if (!material.data || material.data.length <= 1) return [];
            const primary = getPrimaryData(material);
            const secondary = material.data.filter(d => d !== primary);
            
            // Sort by source (DFT > DPA-3 > DPA-1 > others) then by temperature (ascending)
            const sourceOrder = { 'DFT': 1, 'DPA-3': 2, 'DPA-1': 3 };
            secondary.sort((a, b) => {
                const orderA = sourceOrder[a.source] || 99;
                const orderB = sourceOrder[b.source] || 99;
                if (orderA !== orderB) {
                    return orderA - orderB;
                }
                return a.temperature - b.temperature;
            });
            
            return secondary;
        }
        
        async function runTests() {
            const resultsDiv = document.getElementById('test-results');
            
            try {
                // ä»éƒ¨ç½²ç½‘ç«™è·å–å®é™…æ•°æ®
                const response = await fetch('https://wqchen007.github.io/jkw-7element-alloy-database/data/materials.json');
                const materials = await response.json();
                
                resultsDiv.innerHTML = '<h2>âœ… æˆåŠŸåŠ è½½ ' + materials.length + ' ä¸ªææ–™</h2>';
                
                // æµ‹è¯•å‰5ä¸ªææ–™
                materials.slice(0, 5).forEach((material, index) => {
                    const primary = getPrimaryData(material);
                    const secondary = getSecondaryData(material);
                    
                    let html = '<div class="test-case">';
                    html += '<h3>æµ‹è¯• ' + (index + 1) + ': ' + material.name + ' (ID: ' + material.id + ')</h3>';
                    html += '<p><strong>ç»„æˆ:</strong> ' + material.composition + '</p>';
                    html += '<p><strong>æ•°æ®æ¡ç›®æ•°:</strong> ' + material.data.length + '</p>';
                    
                    // æ˜¾ç¤ºåŸå§‹æ•°æ®é¡ºåº
                    html += '<h4>ğŸ“„ åŸå§‹æ•°æ®é¡ºåº:</h4>';
                    material.data.forEach((d, i) => {
                        html += '<div class="data-item">';
                        html += 'ç¬¬' + (i+1) + 'æ¡: ' + d.temperature + 'K, ' + d.source;
                        html += '</div>';
                    });
                    
                    // æ˜¾ç¤ºé€‰ä¸­çš„ä¸»æ•°æ®
                    html += '<h4>â­ é€‰ä¸­çš„ä¸»æ•°æ® (Primary):</h4>';
                    html += '<div class="data-item primary">';
                    html += primary.temperature + 'K, ' + primary.source;
                    html += '</div>';
                    
                    // æ˜¾ç¤ºæ’åºåçš„æ¬¡è¦æ•°æ®
                    if (secondary.length > 0) {
                        html += '<h4>ğŸ“Š æ’åºåçš„æ¬¡è¦æ•°æ® (Secondary):</h4>';
                        secondary.forEach((d, i) => {
                            html += '<div class="data-item secondary">';
                            html += 'ç¬¬' + (i+1) + 'æ¡: ' + d.temperature + 'K, ' + d.source;
                            html += '</div>';
                        });
                    }
                    
                    // éªŒè¯æ’åºæ˜¯å¦æ­£ç¡®
                    let sortingCorrect = true;
                    const sourceOrder = { 'DFT': 1, 'DPA-3': 2, 'DPA-1': 3 };
                    for (let i = 0; i < secondary.length - 1; i++) {
                        const curr = secondary[i];
                        const next = secondary[i + 1];
                        const currOrder = sourceOrder[curr.source] || 99;
                        const nextOrder = sourceOrder[next.source] || 99;
                        
                        if (currOrder > nextOrder) {
                            sortingCorrect = false;
                            break;
                        }
                        if (currOrder === nextOrder && curr.temperature > next.temperature) {
                            sortingCorrect = false;
                            break;
                        }
                    }
                    
                    html += '<h4>âœ“ éªŒè¯ç»“æœ:</h4>';
                    html += '<p style="color: ' + (sortingCorrect ? 'green' : 'red') + '">';
                    html += sortingCorrect ? 'âœ… æ’åºæ­£ç¡®' : 'âŒ æ’åºé”™è¯¯';
                    html += '</p>';
                    
                    html += '</div>';
                    resultsDiv.innerHTML += html;
                });
                
            } catch (error) {
                resultsDiv.innerHTML = '<h2 style="color: red;">âŒ åŠ è½½å¤±è´¥</h2>';
                resultsDiv.innerHTML += '<pre>' + error.message + '</pre>';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        runTests();
    </script>
</body>
</html>
