# Directory Structure Guide

## Overview

This document describes the file organization for the alloy materials database, including data files, structure files, and supporting data.

## Main Directory Structure

```
data/
├── materials.json                    # Main materials database (merged, with auto-generated IDs)
├── intermetallic/                    # Intermetallic compounds organized by source
│   ├── mp-bbgt/                      # Materials Project ID: mp-bbgt
│   │   ├── POSCAR                    # Crystal structure (DFT relaxed)
│   │   ├── rdf.dat                   # Radial distribution function (optional)
│   │   └── stress_strain.dat         # Stress-strain data (optional)
│   ├── mp-be/
│   │   └── POSCAR
│   ├── mp-beq/
│   │   └── POSCAR
│   └── ...                           # More Materials Project entries
├── solid-solution/                   # Solid solution alloys (future expansion)
│   ├── custom-001/
│   │   ├── POSCAR
│   │   └── ...
│   └── ...
└── poscar/                           # Legacy structure (being phased out)

backend/data/
├── materials.json                    # Copy for backend API serving
└── materials_intermetallic.json      # Intermetallic reference data
```

## Directory Naming Convention

Each material's data is stored in a directory named after its **source ID**:

- **Materials Project**: Use MP ID format `mp-xxxxx`
  - Example: `mp-bbgt`, `mp-be`, `mp-beq`
- **Custom data**: Use descriptive identifier
  - Example: `custom-001`, `lab-sample-A`, `exp-2024-001`

## File Types and Locations

### 1. Crystal Structure Files (POSCAR)

**Location**: `data/{type}/{source-id}/POSCAR`

**Default assumption**: Structure from **DFT relaxation**

**Example**:
```
data/intermetallic/mp-bbgt/POSCAR
```

**Format**: VASP POSCAR format (5 or 6 line header)

### 2. Radial Distribution Function (RDF)

**Location**: `data/{type}/{source-id}/rdf.dat`

**Optional**: Include if available

**Example**:
```
data/intermetallic/mp-bbgt/rdf.dat
```

**Format**: Two-column text file (distance, g(r))

### 3. Stress-Strain Curves

**Location**: `data/{type}/{source-id}/stress_strain.dat`

**Optional**: Include if available

**Example**:
```
data/intermetallic/mp-bbgt/stress_strain.dat
```

**Format**: Two-column text file (strain, stress in GPa)

### 4. Materials Database JSON

**Location**: `data/materials.json`

**Description**: Main database file containing all materials with:
- Auto-generated IDs (Alloy-XX-#####)
- Material properties
- References to POSCAR/data files

**Generated by**: System scripts that merge individual material entries

## Material Type Organization

Materials are organized by type in subdirectories:

| Type | Directory | ID Prefix | Description |
|------|-----------|-----------|-------------|
| Element | `data/element/` | `Alloy-E-` | Pure elements |
| Solid Solution | `data/solid-solution/` | `Alloy-SS-` | Solid solution alloys |
| Intermetallic | `data/intermetallic/` | `Alloy-IM-` | Intermetallic compounds |
| Amorphous | `data/amorphous/` | `Alloy-AM-` | Amorphous materials |
| Interface | `data/interface/` | `Alloy-IF-` | Interface structures |

## Adding New Materials

### Step 1: Create Source Directory

```bash
mkdir -p data/intermetallic/mp-xxxxx
```

### Step 2: Add Structure File

Place your POSCAR file:
```bash
cp your_structure.vasp data/intermetallic/mp-xxxxx/POSCAR
```

### Step 3: Add Optional Data Files

```bash
cp rdf_data.txt data/intermetallic/mp-xxxxx/rdf.dat
cp stress_strain.txt data/intermetallic/mp-xxxxx/stress_strain.dat
```

### Step 4: Create Material JSON Entry

Create a JSON file with material properties (without `id` field):

```json
{
  "name": "Nb20Al10",
  "source": "mp-xxxxx",
  "type": "intermetallic",
  "composition": "Nb20Al10",
  "elements": ["Nb", "Al"],
  "atomCount": {
    "Nb": 20,
    "Al": 10
  },
  "poscar": "data/intermetallic/mp-xxxxx/POSCAR",
  "data": [
    {
      "temperature": 0,
      "source": "DFT",
      "properties": {
        "structure": {
          "density": 7.85,
          "rdf": "data/intermetallic/mp-xxxxx/rdf.dat"
        }
      }
    }
  ]
}
```

### Step 5: Run Integration Script

```bash
cd scripts
node merge-materials.js
```

This will:
- Assign auto-generated ID (e.g., "Alloy-IM-00124")
- Merge into `data/materials.json`
- Update backend data files

## Path Reference Format

All file paths in JSON should be relative to the repository root:

- ✅ Correct: `"data/intermetallic/mp-bbgt/POSCAR"`
- ✅ Correct: `"data/intermetallic/mp-bbgt/rdf.dat"`
- ❌ Wrong: `"/home/user/data/..."`
- ❌ Wrong: `"../data/..."`

## POSCAR Structure Source

By default, all POSCAR files are assumed to be from **DFT relaxation** (geometry optimization).

The web interface displays: **(structure from DFT relaxation)** / **(结构来自DFT弛豫)**

If your structure is from a different source (MD, experimental, etc.), note this in your documentation or material description, but the POSCAR path remains the same.

## Backend Data Sync

The `backend/data/` directory contains copies of the main database for API serving:

```bash
# Sync data to backend
cp data/materials.json backend/data/
```

This is typically done automatically by deployment scripts.

## Summary

1. **One directory per material**: Named by source ID
2. **POSCAR required**: Structure file (DFT relaxed by default)
3. **Optional data files**: RDF, stress-strain curves
4. **JSON without ID**: System auto-generates Alloy IDs
5. **Relative paths**: All paths relative to repo root
6. **Type organization**: Materials grouped by type in subdirectories
