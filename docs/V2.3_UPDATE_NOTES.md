# Data Structure V2.3 Update - POSCAR Per Data Entry

**Date:** February 13, 2026  
**Version:** 2.3

## Overview

This update moves the `poscar` and `poscar_source` fields from the top-level material object into individual `data[]` entries. This allows each temperature/source condition to have its own corresponding structure file, which is more accurate since different calculations may produce different structures.

## Key Changes

### 1. Data Structure Changes

**Before (V2.2):**
```json
{
  "name": "Material",
  "source": "mp-xxxxx",
  "poscar": "data/intermetallic/mp-xxxxx/DFT/POSCAR",
  "poscar_source": "DFT relaxation",
  "data": [
    {
      "temperature": 0,
      "source": "DFT",
      "properties": {...}
    }
  ]
}
```

**After (V2.3):**
```json
{
  "name": "Material",
  "source": "mp-xxxxx",
  "data": [
    {
      "source": "init",
      "poscar": "data/intermetallic/mp-xxxxx/init/POSCAR"
    },
    {
      "temperature": 0,
      "source": "DFT",
      "poscar": "data/intermetallic/mp-xxxxx/DFT/POSCAR",
      "poscar_source": "DFT relaxation",
      "properties": {...}
    }
  ]
}
```

### 2. Initial Structure Entry

A new optional entry type with `source: "init"` provides the initial/reference structure:

- Contains only `source` and `poscar` fields
- No `temperature` field (represents the starting configuration)
- No `properties` field (no calculated properties)
- Used as reference structure for visualization

### 3. Frontend Updates

#### Structure Visualization Selector

The material detail page now includes:
- **Default view**: Shows 0K DFT structure (if available), otherwise first structure
- **Dropdown selector**: Allows users to choose different structures:
  - Initial Structure (if available)
  - Various temperature/source combinations (e.g., "0K - DFT", "300K - DFT", "0K - DPA-3")
- **Dynamic update**: Structure info updates when selection changes

#### Implementation Details

- `formatDetailContent()` function now:
  1. Scans all `data[]` entries for `poscar` fields
  2. Creates a dropdown if multiple structures exist
  3. Defaults to 0K DFT structure
  4. Displays poscar_source for user context
  
- `updateStructureDisplay()` function:
  - Handles structure selection changes
  - Updates structure source and file link dynamically

### 4. CSV Template Updates

The CSV template now includes an example `init` entry:

```csv
name,source,type,composition,poscar,poscar_source,temperature,data_source,...
Al2Cu4-sample,custom-al2cu4,solid-solution,Al2Cu4,data/solid-solution/custom-al2cu4/init/POSCAR,Initial structure,,init,...
Al2Cu4-sample,custom-al2cu4,solid-solution,Al2Cu4,data/solid-solution/custom-al2cu4/DFT/POSCAR,DFT relaxation,0,DFT,...
```

### 5. Script Updates

#### convert-data-v2.js

- Modified to place `poscar` and `poscar_source` in each `data[]` entry
- Special handling for `init` source entries (no temperature, no properties)
- Validation updated to allow `init` entries without temperature/properties

## Benefits

1. **Accuracy**: Each calculation/temperature can have its own structure file
2. **Flexibility**: Support for multiple structures per material
3. **Clarity**: Initial structures clearly separated from calculated structures
4. **User Experience**: Easy structure comparison via dropdown selector

## Migration Guide

### For Existing JSON Data

If you have materials with top-level `poscar` field:

**Old format:**
```json
{
  "poscar": "data/type/id/POSCAR",
  "data": [...]
}
```

**New format:**
```json
{
  "data": [
    {
      "temperature": 0,
      "source": "DFT",
      "poscar": "data/type/id/DFT/POSCAR",
      "properties": {...}
    }
  ]
}
```

### For CSV Data

Simply ensure each row has:
- `poscar` column: path to structure file for that specific condition
- `poscar_source` column (optional): description of structure origin
- `data_source` column: `init`, `DFT`, `DPA-1`, etc.

## Validation

The updated validation rules:

### For `init` entries:
- ‚úÖ Required: `source` = "init"
- ‚úÖ Required: `poscar` field
- ‚ùå Not required: `temperature`, `properties`

### For regular entries:
- ‚úÖ Required: `temperature`, `source`, `poscar`, `properties`
- ‚úÖ Optional: `poscar_source`

## Testing

Test files created:
- `test-new-structure.json` - Sample data with new structure
- `test-new-structure.html` - Visual test page

To test:
1. Open `test-new-structure.html` in browser
2. Verify dropdown selector appears
3. Change structure selection and verify update
4. Check that default is "0K - DFT"

## Files Modified

1. `/docs/DATA_STRUCTURE_V2.md` - Updated schema and examples
2. `/example-template-v2.csv` - Added init entry examples
3. `/frontend/index.html` - Added structure selector UI
4. `/_site/index.html` - Updated deployed version
5. `/scripts/convert-data-v2.js` - Modified conversion logic

## Compatibility

- ‚úÖ **Backward compatible**: Frontend can still read old format (top-level poscar)
- ‚úÖ **Forward compatible**: New format is more flexible
- ‚ö†Ô∏è  **Recommendation**: Update all data to new format for consistency

## Next Steps

1. ‚úÖ Documentation updated
2. ‚úÖ CSV template updated
3. ‚úÖ Frontend updated with selector
4. ‚úÖ Conversion script updated
5. ‚úÖ Test files created
6. üîÑ Convert existing JSON data to new format (if needed)
7. üîÑ Test with real data files

---

**Questions or Issues?** Check the updated documentation in `/docs/DATA_STRUCTURE_V2.md`
